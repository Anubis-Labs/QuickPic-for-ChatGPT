<!DOCTYPE html>
<html>
<head>
  <title>QuickPic for ChatGPT - Capture Screen</title>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #f0f4ff 0%, #e6f7f2 100%);
      color: #333;
      overflow: hidden;
    }
    
    .capture-container {
      text-align: center;
      max-width: 800px;
      width: 100%;
      padding: 40px;
      box-sizing: border-box;
    }
    
    .capture-card {
      background-color: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.05);
      margin-bottom: 40px;
    }
    
    .logo {
      width: 80px;
      height: 80px;
      background-color: #10a37f;
      border-radius: 16px;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      box-shadow: 0 6px 10px rgba(16, 163, 127, 0.2);
    }
    
    .logo svg {
      width: 90%;
      height: 90%;
      fill: white;
    }
    
    h1 {
      color: #10a37f;
      font-size: 28px;
      font-weight: 600;
      margin: 0 0 10px;
    }
    
    .subtitle {
      font-size: 18px;
      color: #666;
      margin: 0 0 30px;
    }
    
    .status-message {
      font-size: 18px;
      margin: 30px 0;
      padding: 20px;
      border-radius: 12px;
      background-color: rgba(16, 163, 127, 0.08);
      display: inline-flex;
      align-items: center;
      color: #10a37f;
    }
    
    .status-message svg {
      width: 24px;
      height: 24px;
      margin-right: 12px;
      fill: #10a37f;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(0.95);
        opacity: 0.7;
      }
      70% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(0.95);
        opacity: 0.7;
      }
    }
    
    .instructions {
      font-size: 16px;
      line-height: 1.6;
      margin-top: 30px;
      color: #666;
      text-align: left;
    }
    
    .instructions p {
      margin: 0 0 15px;
    }
    
    .instruction-step {
      display: flex;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    
    .step-number {
      background-color: #10a37f;
      color: white;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-weight: 600;
      margin-right: 15px;
      flex-shrink: 0;
    }
    
    .footer {
      font-size: 14px;
      color: #888;
      margin-top: 40px;
    }
    
    .footer a {
      color: #10a37f;
      text-decoration: none;
      font-weight: 500;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }
    
    .close-info {
      position: fixed;
      bottom: 20px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      font-size: 14px;
      opacity: 0.9;
    }
    
    .close-info kbd {
      background-color: #333;
      padding: 2px 6px;
      border-radius: 4px;
      margin: 0 3px;
      font-family: monospace;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <div class="capture-container">
    <div class="capture-card">
      <div class="logo">
        <svg viewBox="0 0 24 24">
          <path d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z" />
        </svg>
      </div>
      <h1>Screen Capture</h1>
      <div class="subtitle">QuickPic for ChatGPT</div>
      
      <div class="status-message">
        <svg viewBox="0 0 24 24">
          <path d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z" />
        </svg>
        Please select a screen or window to capture...
      </div>
      
      <div class="instructions">
        <p>Follow these steps to capture your screen:</p>
        
        <div class="instruction-step">
          <div class="step-number">1</div>
          <div>Choose the screen, window, or tab you want to capture from the browser dialog that appears</div>
        </div>
        
        <div class="instruction-step">
          <div class="step-number">2</div>
          <div>Click the "Share" button to confirm your selection</div>
        </div>
        
        <div class="instruction-step">
          <div class="step-number">3</div>
          <div>The screenshot will be automatically uploaded to your active ChatGPT conversation</div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      QuickPic for ChatGPT v1.0 â€¢ <a href="https://github.com/Anubis-Labs/QuickPic-for-ChatGPT" target="_blank">GitHub Repository</a>
    </div>
  </div>
  
  <div class="close-info">
    You can close this window after capture is complete or press <kbd>Esc</kbd> to cancel
  </div>

  <script>
    // Listen for messages from the background script
    chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {
      if (request.action === "captureScreen") {
        captureScreen();
      }
    });

    // Send a ready message to the background script
    chrome.runtime.sendMessage({action: "capturePageReady"});

    // Function to capture the screen
    async function captureScreen() {
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({
          video: {
            cursor: "always"
          },
          audio: false
        });
        
        // Create video element to capture a frame
        const video = document.createElement('video');
        video.srcObject = stream;
        
        // Once video is loaded, capture a frame
        video.onloadedmetadata = function() {
          video.play();
          
          // Give a slight delay to ensure video is playing
          setTimeout(() => {
            // Create canvas for screenshot
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame to canvas
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Stop the stream tracks
            stream.getTracks().forEach(track => track.stop());
            
            // Convert canvas to blob and send to background script
            canvas.toBlob(function(blob) {
              chrome.runtime.sendMessage({
                action: "processScreenshot",
                screenshot: blob
              });
              
              // Update UI to show capture is complete
              document.querySelector('.status-message').innerHTML = `
                <svg viewBox="0 0 24 24">
                  <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z" />
                </svg>
                Screenshot captured successfully! You can close this window.
              `;
              document.querySelector('.status-message').style.backgroundColor = 'rgba(16, 163, 127, 0.15)';
            }, 'image/png');
          }, 300);
        };
        
      } catch (error) {
        console.error("Error capturing screen:", error);
        document.querySelector('.status-message').innerHTML = `
          <svg viewBox="0 0 24 24" style="fill: #d32f2f;">
            <path d="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
          </svg>
          Error capturing screen. Please try again.
        `;
        document.querySelector('.status-message').style.backgroundColor = 'rgba(211, 47, 47, 0.15)';
        document.querySelector('.status-message').style.color = '#d32f2f';
        
        // Notify background script of error
        chrome.runtime.sendMessage({
          action: "captureError",
          error: error.message
        });
      }
    }
  </script>
</body>
</html> 